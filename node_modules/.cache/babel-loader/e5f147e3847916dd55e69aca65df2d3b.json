{"remainingRequest":"/Users/pavel/Projects/fyas/node_modules/babel-loader/lib/index.js!/Users/pavel/Projects/fyas/node_modules/eslint-loader/index.js??ref--14-0!/Users/pavel/Projects/fyas/src/store/auth.js","dependencies":[{"path":"/Users/pavel/Projects/fyas/src/store/auth.js","mtime":1636356942657},{"path":"/Users/pavel/Projects/fyas/babel.config.js","mtime":1636353948320},{"path":"/Users/pavel/Projects/fyas/node_modules/cache-loader/dist/cjs.js","mtime":1636352989548},{"path":"/Users/pavel/Projects/fyas/node_modules/babel-loader/lib/index.js","mtime":1636352990365},{"path":"/Users/pavel/Projects/fyas/node_modules/eslint-loader/index.js","mtime":1636352989599}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9wYXZlbC9Qcm9qZWN0cy9meWFzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvcGF2ZWwvUHJvamVjdHMvZnlhcy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgcm91dGVyIGZyb20gJy4uL3JvdXRlcic7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7Cgp2YXIgVXNlciA9IGZ1bmN0aW9uIFVzZXIoaWQpIHsKICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVXNlcik7CgogIGlkID0gcGFyc2VJbnQoaWQpOwogIHRoaXMuaWQgPSBpZDsKfTsKCmV4cG9ydCBkZWZhdWx0IHsKICBzdGF0ZTogewogICAgdXNlcjogbnVsbAogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBzZXRVc2VyOiBmdW5jdGlvbiBzZXRVc2VyKHN0YXRlLCBwYXlsb2FkKSB7CiAgICAgIHN0YXRlLnVzZXIgPSBwYXlsb2FkOwogICAgfSwKICAgIHNldFVzZXJEYXRhOiBmdW5jdGlvbiBzZXRVc2VyRGF0YShzdGF0ZSwgX3JlZikgewogICAgICB2YXIgcGF5bG9hZCA9IF9yZWYucGF5bG9hZCwKICAgICAgICAgIHJldHJ5UmVxdWVzdCA9IF9yZWYucmV0cnlSZXF1ZXN0OwogICAgICAvLyBjb25zb2xlLmxvZygnc2V0VXNlckRhdGEnKQogICAgICB2YXIgYmFzZTY0VXJsID0gcGF5bG9hZC50b2tlbi5zcGxpdCgnLicpWzFdOwogICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpOwogICAgICB2YXIgZW5jVG9rZW4gPSBKU09OLnBhcnNlKHdpbmRvdy5hdG9iKGJhc2U2NCkpOwogICAgICBsb2NhbFN0b3JhZ2UudG9rZW4gPSBwYXlsb2FkLnRva2VuOwogICAgICBsb2NhbFN0b3JhZ2UudG9rZW5fZXhwaXJhdGlvbiA9IGVuY1Rva2VuLmV4cDsKICAgICAgbG9jYWxTdG9yYWdlLnJlZnJlc2hfdG9rZW4gPSBwYXlsb2FkLnJlZnJlc2hfdG9rZW47CiAgICAgIGxvY2FsU3RvcmFnZS5yZWZyZXNoX2V4cGlyYXRpb24gPSBwYXlsb2FkLnJlZnJlc2hfZXhwaXJhdGlvbjsKICAgICAgbG9jYWxTdG9yYWdlLnVpZCA9IHBheWxvYWQudXNlcl9pZDsKICAgICAgbG9jYWxTdG9yYWdlLnV1aWQgPSBwYXlsb2FkLnVzZXJfdXVpZDsKICAgICAgbG9jYWxTdG9yYWdlLnVyb2xlID0gZW5jVG9rZW4ucm9sZTsKICAgICAgbG9jYWxTdG9yYWdlLmxvZ2luID0gZW5jVG9rZW4ubG9naW47CiAgICAgIGxvY2FsU3RvcmFnZS5zdG9yZV91dWlkID0gZW5jVG9rZW4uc3RvcmVfdXVpZDsKICAgICAgbG9jYWxTdG9yYWdlLnRheGlfcGFya3NfdXVpZCA9IGVuY1Rva2VuLnRheGlfcGFya3NfdXVpZCA/IGVuY1Rva2VuLnRheGlfcGFya3NfdXVpZCA6ICcnOwogICAgICBzdGF0ZS51c2VyID0gbmV3IFVzZXIocGF5bG9hZC51c2VyX2lkKTsKICAgICAgdGhpcy5fdm0uJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIHBheWxvYWQudG9rZW47CgogICAgICBpZiAocmV0cnlSZXF1ZXN0ICYmIHJldHJ5UmVxdWVzdC5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSAmJiAhcmV0cnlSZXF1ZXN0LmNvbmZpZy5fX2lzUmV0cnlSZXF1ZXN0KSB7CiAgICAgICAgcmV0cnlSZXF1ZXN0LmNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyBwYXlsb2FkLnRva2VuOwogICAgICAgIHJldHJ5UmVxdWVzdC5jb25maWcuX19pc1JldHJ5UmVxdWVzdCA9IHRydWU7CgogICAgICAgIHRoaXMuX3ZtLiRodHRwKHJldHJ5UmVxdWVzdC5jb25maWcpOwogICAgICB9CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBsb2dpblVzZXI6IGZ1bmN0aW9uIGxvZ2luVXNlcihfcmVmMiwgdXNlcikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYyLmNvbW1pdCwKICAgICAgICAgIGRpc3BhdGNoID0gX3JlZjIuZGlzcGF0Y2g7CiAgICAgIGNvbW1pdCgnc2V0TG9hZGluZycsIHRydWUpOwoKICAgICAgdGhpcy5fdm0uJGh0dHAucG9zdCgnYXV0aC9sb2dpbicsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgY29tbWl0KCdzZXRMb2FkaW5nJywgZmFsc2UpOwogICAgICAgIGNvbW1pdCgnc2V0VXNlckRhdGEnLCB7CiAgICAgICAgICBwYXlsb2FkOiByZXNwb25zZS5kYXRhCiAgICAgICAgfSk7CiAgICAgICAgY29tbWl0KCdzZXRNZXNzYWdlJywgJ9CS0Ysg0YPRgdC/0LXRiNC90L4g0LLQvtGI0LvQuCDQsiDRgdC40YHRgtC10LzRgycpOwogICAgICAgIHJvdXRlci5wdXNoKCcvJyk7CgogICAgICAgIF90aGlzLl92bS4kaHR0cC5nZXQoJ3VzZXJzLycgKyBsb2NhbFN0b3JhZ2UudXVpZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIGxvY2FsU3RvcmFnZS5sb2dpblRlbGVwaG9ueSA9IHJlc3BvbnNlLmRhdGEubG9naW5fdGVsZXBob255OwogICAgICAgICAgbG9jYWxTdG9yYWdlLnBhc3N3b3JkVGVsZXBob255ID0gcmVzcG9uc2UuZGF0YS5wYXNzd29yZF90ZWxlcGhvbnk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBkaXNwYXRjaCgndmFsaWRhdGVFcnJvcicsIGVycm9yKTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29tbWl0KCdzZXRMb2FkaW5nJywgZmFsc2UpOwoKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHsKICAgICAgICAgIGNvbW1pdCgnc2V0RXJyb3InLCBlcnJvci5yZXNwb25zZS5kYXRhLm1lc3NhZ2UpOwogICAgICAgIH0gLy8gZGlzcGF0Y2goJ3ZhbGlkYXRlRXJyb3InLCBlcnJvcikKCiAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrVG9rZW46IF8uZGVib3VuY2UoZnVuY3Rpb24gKF9yZWYzLCByZXRyeVJlcXVlc3QpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzLmNvbW1pdCwKICAgICAgICAgIGRpc3BhdGNoID0gX3JlZjMuZGlzcGF0Y2g7CiAgICAgIGlmICghdGhpcy5fdm0uJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbikgdGhpcy5fdm0uJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGxvY2FsU3RvcmFnZS50b2tlbjsKCiAgICAgIHRoaXMuX3ZtLiRodHRwLnBvc3QoJ2F1dGgvcmVmcmVzaCcsIHsKICAgICAgICAncmVmcmVzaCc6IGxvY2FsU3RvcmFnZS5yZWZyZXNoX3Rva2VuCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3Rva2VuIHVwZGF0ZWQnKQogICAgICAgIGNvbW1pdCgnc2V0VXNlckRhdGEnLCB7CiAgICAgICAgICBwYXlsb2FkOiByZXNwb25zZS5kYXRhLAogICAgICAgICAgcmV0cnlSZXF1ZXN0OiByZXRyeVJlcXVlc3QKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIGRpc3BhdGNoKCdsb2dPdXQnKTsKICAgICAgfSk7CiAgICB9LCA1MDApLAogICAgYXV0b0xvZ2luVXNlcjogZnVuY3Rpb24gYXV0b0xvZ2luVXNlcihfcmVmNCwgcGF5bG9hZCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGNvbW1pdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb21taXQgPSBfcmVmNC5jb21taXQ7CiAgICAgICAgICAgICAgICBfdGhpczIuX3ZtLiRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyBsb2NhbFN0b3JhZ2UudG9rZW47CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBjb21taXQoJ3NldFVzZXInLCBuZXcgVXNlcihwYXlsb2FkKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBsb2dPdXQ6IGZ1bmN0aW9uIGxvZ091dChfcmVmNSkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjUuY29tbWl0OwogICAgICByb3V0ZXIucHVzaCgnL2xvZ2luJyk7CiAgICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpOwogICAgICBjb21taXQoJ3NldFVzZXInLCBudWxsKTsKICAgIH0KICB9LAogIGdldHRlcnM6IHsKICAgIHVzZXI6IGZ1bmN0aW9uIHVzZXIoc3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLnVzZXI7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["/Users/pavel/Projects/fyas/src/store/auth.js"],"names":["router","_","User","id","parseInt","state","user","mutations","setUser","payload","setUserData","retryRequest","base64Url","token","split","base64","replace","encToken","JSON","parse","window","atob","localStorage","token_expiration","exp","refresh_token","refresh_expiration","uid","user_id","uuid","user_uuid","urole","role","login","store_uuid","taxi_parks_uuid","_vm","$http","defaults","headers","common","Authorization","response","status","config","__isRetryRequest","actions","loginUser","commit","dispatch","post","then","data","push","get","loginTelephony","login_telephony","passwordTelephony","password_telephony","catch","error","message","checkToken","debounce","autoLoginUser","logOut","clear","getters"],"mappings":"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","sourcesContent":["import router from '../router'\nimport _ from 'lodash'\nclass User {\n  constructor (id) {\n    id = parseInt(id)\n    this.id = id\n  }\n}\n\nexport default {\n  state: {\n    user: null\n  },\n  mutations: {\n    setUser (state, payload) {\n      state.user = payload\n    },\n    setUserData (state, {payload, retryRequest}) {\n      // console.log('setUserData')\n      var base64Url = payload.token.split('.')[1]\n      var base64 = base64Url.replace('-', '+').replace('_', '/')\n      var encToken = JSON.parse(window.atob(base64))\n      localStorage.token = payload.token\n      localStorage.token_expiration = encToken.exp\n      localStorage.refresh_token = payload.refresh_token\n      localStorage.refresh_expiration = payload.refresh_expiration\n      localStorage.uid = payload.user_id\n      localStorage.uuid = payload.user_uuid\n      localStorage.urole = encToken.role\n      localStorage.login = encToken.login\n      localStorage.store_uuid = encToken.store_uuid\n      localStorage.taxi_parks_uuid = encToken.taxi_parks_uuid ? encToken.taxi_parks_uuid : ''\n      state.user = new User(payload.user_id)\n      this._vm.$http.defaults.headers.common.Authorization = 'Bearer ' + payload.token\n      if (retryRequest && retryRequest.response.status === 401 && !retryRequest.config.__isRetryRequest) {\n        retryRequest.config.headers.Authorization = 'Bearer ' + payload.token\n        retryRequest.config.__isRetryRequest = true\n        this._vm.$http(retryRequest.config)\n      }\n    }\n  },\n  actions: {\n    loginUser ({commit, dispatch}, user) {\n      commit('setLoading', true)\n      this._vm.$http\n      .post('auth/login', user)\n      .then(response => {\n        commit('setLoading', false)\n        commit('setUserData', {payload: response.data})\n        commit('setMessage', 'Вы успешно вошли в систему')\n        router.push('/')\n        this._vm.$http\n          .get('users/' + localStorage.uuid)\n          .then(response => {\n            localStorage.loginTelephony = response.data.login_telephony\n            localStorage.passwordTelephony = response.data.password_telephony\n          }).catch(error => {\n            dispatch('validateError', error)\n          })\n      })\n      .catch(error => {\n        commit('setLoading', false)\n        if (error.response.status === 401) {\n          commit('setError', error.response.data.message)\n        }\n        // dispatch('validateError', error)\n      })\n    },\n    checkToken: _.debounce(function ({ commit, dispatch }, retryRequest) {\n      if (!this._vm.$http.defaults.headers.common.Authorization) this._vm.$http.defaults.headers.common.Authorization = 'Bearer ' + localStorage.token\n      this._vm.$http\n        .post('auth/refresh', {'refresh': localStorage.refresh_token}).then(response => {\n          // console.log('token updated')\n          commit('setUserData', {payload: response.data, retryRequest})\n        })\n        .catch(() => {\n          dispatch('logOut')\n        })\n    }, 500),\n\n    async autoLoginUser ({commit}, payload) {\n      this._vm.$http.defaults.headers.common.Authorization = 'Bearer ' + localStorage.token\n      await commit('setUser', new User(payload))\n    },\n\n    logOut ({commit}) {\n      router.push('/login')\n      localStorage.clear()\n      commit('setUser', null)\n    }\n  },\n\n  getters: {\n    user (state) {\n      return state.user\n    }\n  }\n}\n"]}]}